#!/bin/bash

if [ $# -ne 1 ]; then
    echo "Please provide the input CSV file as a parameter"
    exit 1
fi

input_file="$1"
if [ ! -f "$input_file" ]; then
    echo "File not found: $input_file"
    exit 1
fi

rm -rf /tmp/msgsend_*

#Get the Date and Time for naming the file
script_File_With_date=/tmp/msgsend_$(date +"%d-%h-%Y_%I:%M:%S_%p").sh

# Get the column positions
number_col=$(head -n 1 "$input_file" | tr ',' '\n' | cat -n | grep 'Patient_Cell_No' | awk '{print $1}')
money_col=$(head -n 1 "$input_file" | tr ',' '\n' | cat -n | grep 'patient_balance' | awk '{print $1}')

# Extract the values and format the output
tail -n +2 $input_file | while read line; do
    number=$(echo "$line" | cut -d ',' -f "$number_col" | tr -d '-')
    money=$(echo "$line" | cut -d ',' -f "$money_col")
    echo "curl -X POST https://api.twilio.com/2010-04-01/Accounts/AC2a1d2545d7c4388bce7f8cebf8bb5641/Messages.json \\">> $script_File_With_date
    echo "--data-urlencode \"To=+1$number\" \\" >> $script_File_With_date
    echo "--data-urlencode \"From=+15613635561\" \\" >> $script_File_With_date
    echo "--data-urlencode \"Body=You have an outstanding balance of \$ $money with Allergy Consultant Inc.To make a payment via Phone or if you have any questions, Please call us at 5613687006. Reply STOP to optout.\" \\" >> $script_File_With_date
    echo "-u \"AC2a1d2545d7c4388bce7f8cebf8bb5641:06c980d9b27e54e18952a05a611485bb\"" >> $script_File_With_date
    echo "" >> $script_File_With_date
done
total_lines=$(wc -l < $script_File_With_date | awk '{print $1}')
msg_count=`expr $total_lines / 6`
    echo "Total Messages $msg_count"
    echo "Message Script Created : $script_File_With_date"
    
------------------------------------
    
Modify the above script to add "if cut will be happened correctly from csv file then execute the the lines from after done else not exectue"
